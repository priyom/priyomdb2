<?xml version="1.0"?>
<library
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:tea="https://xmlns.zombofant.net/xsltea/processors"
    xmlns:form="https://xmlns.zombofant.net/xsltea/form"
    xmlns:l10n="https://xmlns.zombofant.net/xsltea/l10n"
    xmlns:exec="https://xmlns.zombofant.net/xsltea/exec">

  <tea:def tea:name="recent-entries">
    <tea:arg name="recents" mode="lazy" default="recents" />
    <tea:arg name="view_station" mode="lazy" default="view_station" />
    <tea:arg name="view_event" mode="lazy" default="view_event" />
    <h3>Recent entries</h3>
    <table>
      <colgroup>
        <col class="id" />
        <col />
        <col />
        <col />
      </colgroup>
      <thead>
        <tr>
          <th>#</th>
          <th>Submitter</th>
          <th>Station</th>
          <th>Timestamp</th>
        </tr>
      </thead>
      <tbody>
        <tea:for-each tea:bind="event" tea:from="recents">
          <tr>
            <td>
              <tea:switch>
                <tea:case exec:eval="view_event">
                  <a exec:href="context.href(view_event, event_id=event.id)"><exec:text>event.id</exec:text></a>
                </tea:case>
                <tea:default>
                  <exec:text>event.id</exec:text>
                </tea:default>
              </tea:switch>
            </td>
            <td>
              <tea:switch>
                <tea:case exec:eval="event.submitter">
                  <exec:text>event.submitter</exec:text>
                </tea:case>
                <tea:default>system generated</tea:default>
              </tea:switch>
            </td>
            <td>
              <tea:switch>
                <tea:case exec:eval="view_station">
                  <a exec:href="context.href(view_station, station_id=event.station.id)"><exec:text>event.station</exec:text></a>
                </tea:case>
                <tea:default><exec:text>event.station</exec:text></tea:default>
              </tea:switch>
            </td>
            <td><l10n:datetime>event.start_time</l10n:datetime></td>
          </tr>
        </tea:for-each>
      </tbody>
    </table>
  </tea:def>

  <tea:def tea:name="mine">
    <tea:arg name="mine" mode="lazy" default="mine" />
    <h3>My logs</h3>
    <table>
      <colgroup>
        <col class="id" />
        <col />
        <col />
        <col class="tx-content"/>
      </colgroup>
      <thead>
        <tr>
          <th>#</th>
          <th>Station</th>
          <th>Timestamp</th>
          <th>Contents / Event</th>
        </tr>
      </thead>
      <tbody>
        <tea:for-each tea:bind="event" tea:from="mine">
          <tr>
            <td><exec:text>event.id</exec:text></td>
            <td><exec:text>event.station</exec:text></td>
            <td><exec:text>event.modified</exec:text></td>
            <td class="tx-content">
              <tea:call tea:src="library.xml" tea:name="event_contents">
                <tea:pass name="event">event</tea:pass>
              </tea:call>
            </td>
          </tr>
        </tea:for-each>
      </tbody>
    </table>
  </tea:def>

  <tea:def tea:name="unapproved">
    <tea:arg name="unapproved" mode="lazy" default="unapproved" />
    <tea:arg name="view_station" mode="lazy" default="view_station" />
    <tea:arg name="view_event" mode="lazy" default="view_event" />
    <h3>Log entry moderation queue</h3>
    <tea:switch>
      <tea:case exec:eval="unapproved.count() > 0">
        <table>
          <colgroup>
            <col class="id" />
            <col />
            <col />
            <col />
          </colgroup>
          <thead>
            <tr>
              <th>#</th>
              <th>Submitter</th>
              <th>Station</th>
              <th>Timestamp</th>
            </tr>
          </thead>
          <tbody>
            <tea:for-each tea:bind="event" tea:from="unapproved">
              <tr>
                <td><exec:text>event.id</exec:text></td>
                <td>
                  <tea:switch>
                    <tea:case exec:eval="event.submitter">
                      <exec:text>event.submitter</exec:text>
                    </tea:case>
                    <tea:default>system generated</tea:default>
                  </tea:switch>
                </td>
                <td><exec:text>event.station</exec:text></td>
                <td><l10n:datetime>event.start_time</l10n:datetime></td>
              </tr>
            </tea:for-each>
          </tbody>
        </table>
      </tea:case>
      <tea:default>
        <p>Currently, there are no entries waiting for moderation.</p>
      </tea:default>
    </tea:switch>
  </tea:def>

</library>
