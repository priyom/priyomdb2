<?xml version="1.0"?>
<library
    xmlns:tea="https://xmlns.zombofant.net/xsltea/processors"
    xmlns:exec="https://xmlns.zombofant.net/xsltea/exec">
  <tea:def tea:name="page">
    <tea:arg name="page" mode="lazy" default="page" />
    <tea:arg name="view" mode="lazy" default="view" />
    <tea:arg name="pageno" mode="lazy" default="pageno" />
    <li exec:class="'current' if page.page == pageno else None">
      <a exec:href="href(view, page=page.at_page(pageno))"><exec:text>pageno</exec:text></a>
    </li>
  </tea:def>
  <tea:def tea:name="pagination">
    <tea:arg name="page" />
    <tea:arg name="view" />
    <exec:code>total_pages = page.total_pages</exec:code>
    <exec:code>
def calculate_range(start_at, end_at):
    skip_before, skip_after = True, True
    if start_at &lt;= 3:
        skip_before = False
        start_at = 2
    if end_at &gt;= page.total_pages - 2:
        skip_after = False
        end_at = page.total_pages - 1
    return skip_before, skip_after, start_at, end_at
start_at = page.page - 2
end_at = page.page + 2
skip_before, skip_after, start_at, end_at = calculate_range(start_at, end_at)
if skip_before and not skip_after:
    start_at = end_at - 5
    skip_before, skip_after, start_at, end_at = calculate_range(start_at, end_at)
elif skip_after and not skip_before:
    end_at = start_at + 5
    skip_before, skip_after, start_at, end_at = calculate_range(start_at, end_at)
pagerange = range(start_at, end_at+1)</exec:code>
    <ul class="pagination">
      <exec:if condition="page.page &gt; 1">
        <li class="wide">
          <a exec:href="href(view, page=page.at_page(page.page-1))">« prev</a>
        </li>
      </exec:if>
      <tea:call tea:name="page">
        <tea:pass name="pageno">1</tea:pass>
      </tea:call>
      <exec:if condition="skip_before">
        <li><div class="fakebutton">…</div></li>
      </exec:if>
      <tea:for-each tea:bind="pageno" tea:from="pagerange">
        <tea:call tea:name="page" />
      </tea:for-each>
      <exec:if condition="skip_after">
        <li><div class="fakebutton">…</div></li>
      </exec:if>
      <exec:if condition="page.total_pages &gt; 1">
        <tea:call tea:name="page">
          <tea:pass name="pageno">total_pages</tea:pass>
        </tea:call>
      </exec:if>
      <exec:if condition="page.page &lt; page.total_pages">
        <li class="wide">
          <a exec:href="href(view, page=page.at_page(page.page+1))">next »</a>
        </li>
      </exec:if>
    </ul>
  </tea:def>
</library>
