<?xml version="1.0" ?>
<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:tea="https://xmlns.zombofant.net/xsltea/processors"
     xmlns:exec="https://xmlns.zombofant.net/xsltea/exec">
  <exec:code>view_events = arguments['view_events']</exec:code>
  <exec:code>event_view = arguments['event_view']</exec:code>
  <exec:code>view_event = arguments['view_event']</exec:code>
  <exec:code>recent_events = arguments['recent_events']</exec:code>
  <h2>Most recent events</h2>
  <aside class="sidebar"><div class="sbox">
    <a exec:href="href(view_events, view=event_view)"
       class="ym-button ym-reply">View all</a>
  </div></aside>
  <table>
    <colgroup>
      <col />
      <col />
      <col />
      <col />
    </colgroup>
    <thead>
      <th>#</th>
      <th>Modified</th>
      <th>Submitter</th>
      <th>Timestamp</th>
      <th>Contents</th>
      <th>Actions</th>
    </thead>
    <tbody>
      <tea:for-each tea:bind="event" tea:from="recent_events">
        <tr>
          <td><exec:text>event.id</exec:text></td>
          <td><exec:text>event.modified</exec:text></td>
          <td>
            <tea:switch>
              <tea:case exec:eval="event.submitter">
                <exec:text>event.submitter</exec:text>
              </tea:case>
              <tea:default>system generated</tea:default>
            </tea:switch>
          </td>
          <td><exec:text>event.start_time</exec:text></td>
          <td class="tx-content">
            <tea:call tea:src="library.xml" tea:name="event_contents">
              <tea:pass name="event">event</tea:pass>
            </tea:call>
          </td>
          <td>
            <exec:code>can_edit = request.auth.has_capability(Capability.EDIT_EVENT)</exec:code>
            <a exec:class="'ym-button ym-primary '+
                           ('ym-edit' if can_edit else '')"
               exec:href="href(view_event, id=event.id)">
              <exec:text>'Edit' if can_edit else 'View'</exec:text>
            </a>
          </td>
        </tr>
      </tea:for-each>
    </tbody>
  </table>
</div>
